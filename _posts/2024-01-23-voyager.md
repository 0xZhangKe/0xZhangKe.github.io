---
layout: post
category: computer
title: "Compose æœ€å¼ºå¯¼èˆªæ¡†æ¶ Voyager å®Œå…¨ä½¿ç”¨æŒ‡å—"
author: ZhangKe
date:   2024-01-23 23:44:30 +0800
---

[Voyager](https://voyager.adriel.cafe/) æ˜¯ä¸€ä¸ªä¸“ä¸º Compose é¡µé¢å¯¼èˆªç¼–å†™çš„æ¡†æ¶ï¼Œç±»ä¼¼äº Jetpack Navigationï¼Œä½†å®ƒæ”¯æŒ Compose è·¨å¹³å°ï¼Œä»¥ API ç®€æ´å¥½ç”¨è€Œå¹¿å—å¥½è¯„ï¼Œæˆ‘ä¹‹å‰ç”¨çš„ä¹Ÿæ˜¯ Jetpack Navigationï¼Œåé¢è½¬åˆ° Voyager ä¹‹åå°±å†ä¹Ÿå›ä¸å»äº†ï¼ŒAPI è®¾è®¡çš„éå¸¸å·§å¦™ï¼Œæ–‡æ¡£å¾ˆè¯¦ç»†ï¼Œç¤¾åŒºä¹Ÿå¾ˆæ´»è·ƒã€‚

ç›®å‰ Voyager å·²ç»æ”¯æŒäº†å‡ ä¹æ‰€æœ‰çš„ä½¿ç”¨åœºæ™¯ï¼Œç°åœ¨æˆ‘å¤§æ¦‚ç”¨äº†ä¸€å¹´äº†ï¼Œä»Šå¤©å†™ä¸€ç¯‡æ–‡ç« æ¥æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ç»éªŒï¼Œä»¥åŠä¸€äº›å®˜æ–¹æ–‡æ¡£æ²¡æœ‰çš„ä½¿ç”¨æŠ€å·§ã€‚

# ç®€ä»‹

Voyager å®˜ç½‘åœ°å€ï¼š[https://voyager.adriel.cafe/](https://voyager.adriel.cafe/)

å¯¹äºæ²¡ç”¨è¿‡å• Activity + Compose UI çš„æ¶æ„çš„æœ‹å‹æ¥è¯´å¯èƒ½å¯¼èˆªæ¡†æ¶æœ‰ç‚¹é™Œç”Ÿã€‚åœ¨è¯¥æ¶æ„ä¸‹ï¼Œé¡µé¢çš„å®šä¹‰è·Ÿä¼ ç»Ÿ Android å¼€å‘æœ‰äº›åŒºåˆ«ï¼Œå¯¹äºä¼ ç»Ÿ Android å¼€å‘æ¥è¯´ï¼Œé¡µé¢å°±æ˜¯æŒ‡ Activity/Fragmentï¼Œä½†å¯¹äºå• Activity + Compose é¡µé¢çš„æ¶æ„æ¥è¯´ï¼Œ**é¡µé¢çš„å®šä¹‰å°±ç”±å¯¼èˆªæ¡†æ¶æ¥å®šä¹‰**äº†ã€‚

è¿™æ˜¯å› ä¸ºï¼Œå• Activity çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ Activity ä¸­è®¾ç½®ä¸€ä¸‹ `setContent` å°† Compose UI æ³¨å…¥åˆ° Activity ä¸­ï¼Œå‰©ä¸‹çš„å¯¹äº Activity æ¥è¯´å°±éƒ½åªæ˜¯ Compose UI äº†ï¼Œä½†å¯¹äº Compose UI æ¥è¯´ï¼Œæˆ‘ä»¬ä»ç„¶æ˜¯ç”±é¡µé¢çš„åŒºåˆ«çš„ï¼Œä¸šåŠ¡ä¸Šä¹Ÿéƒ½æ˜¯ä¸åŒçš„é¡µé¢ï¼Œæ­¤æ—¶å°±éœ€è¦ä¸€ä¸ªå·¥å…·ç”¨æ¥å°†è¿™ä¸€å¤§å¨ Compose UI ä»£ç æŒ‰ç…§ Activity ä¸€æ ·ç»„ç»‡æˆé¡µé¢ï¼Œé‚£ä¹ˆ Voyager å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œå¹¶ä¸”è§£å†³çš„æ–¹å¼éå¸¸ä¼˜é›…ã€‚

ç›®å‰ Voyager ä¸ä»…æ”¯æŒé¡µé¢å®šä¹‰å’Œå¯¼èˆªï¼ŒåŒæ ·ä¹Ÿæ”¯æŒ ViewModel å’Œä¾èµ–æ³¨å…¥ï¼Œå‡ ä¹å¯ä»¥æ— ç¼å¯¹æ¥ä½¿ç”¨ã€‚

ä½¿ç”¨èµ·æ¥å¤§æ¦‚ä¼šæ˜¯è¿™æ ·ï¼š

```jsx
class HomeScreenModel : ScreenModel {
    // ...
}

class HomeScreen : Screen {

    @Composable
    override fun Content() {
        val screenModel = rememberScreenModel { HomeScreenModel() }
        // ...
    }
}

class SingleActivity : ComponentActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        setContent {
            Navigator(HomeScreen())
        }
    }
}
```

# ä½¿ç”¨

## Screen-é¡µé¢

åœ¨ Voyager ä¸­ï¼Œ**é¡µé¢è¢«å®šä¹‰åä¸º Screen çš„å¯¹è±¡**ï¼ˆæ‰€ä»¥è¿™é‡Œç§°å‘¼ä¸ºå±å¹•ä¼¼ä¹æ›´åˆé€‚ï¼Œä½œä¸ºä¸€ä¸ªè·¨å¹³å°çš„å¯¼èˆªæ¡†æ¶æ¥è¯´ï¼Œå«å±å¹•å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç±»æ¯” Activity/Fragmentï¼Œåªä¸è¿‡å®ƒè¦ç®€å•å¾ˆå¤šã€‚

```jsx
public actual interface Screen : Serializable {
    public actual val key: ScreenKey
        get() = commonKeyGeneration()

    @Composable
    public actual fun Content()
}
```

è¿™ä¸ªæ¥å£æ²¡æœ‰ä»»ä½•ç‰¹æ®Šä¹‹å¤„ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª**æ™®é€šçš„ Kotlin æ¥å£**ï¼Œç®€å•æ˜äº†ã€‚

ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé¡µé¢ï¼š

```jsx
class HomeScreen : Screen {

    @Composable
    override fun Content() {
        val screenModel = rememberScreenModel { HomeScreenModel() }
        // ...
    }
}
```

HomeScreen ä¹Ÿæ˜¯ä¸ªæ™®é€šçš„ Kotlin ç±»ï¼Œä¹ŸåŒæ ·æ²¡æœ‰ä»»ä½•ç‰¹æ®Šä¹‹å¤„ï¼Œå‡å¦‚è¿™ä¸ªé¡µé¢æœ‰å…¥å‚çš„è¯ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥æŠŠå®ƒå®šä¹‰ä¸º `data class`ã€‚

```kotlin
data class HomeScreen(val title: String) : Screen {

    @Composable
    override fun Content() {
    }
}
```

ç”±äº Voyager çš„çŠ¶æ€æŒä¹…åŒ–å­˜å‚¨ç‰¹æ€§ï¼Œ**Screen æ„é€ å™¨ä¸­çš„å‚æ•°éœ€è¦æ”¯æŒåºåˆ—åŒ–**ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰æˆ**å•ä¾‹ç±»**ï¼š

```kotlin
object HomeScreen : Screen {

    @Composable
    override fun Content() {
    }
}
```

å¯ä»¥çœ‹åˆ° Screen ä¸­æä¾›äº†ä¸€ä¸ª Composable å‡½æ•°ï¼Œæˆ‘ä»¬çš„ Compose ä»£ç å†™åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢å³å¯ã€‚

## Navigation-å¯¼èˆª

### Navigator

Navigator æ˜¯ Voyager å¯¼èˆªçš„èµ·ç‚¹å’Œå…¥å£ï¼Œå®ƒæ˜¯ä¸€ä¸ª Composable å‡½æ•°ï¼Œ**è´Ÿè´£ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€è¿”å›äº‹ä»¶ã€çŠ¶æ€æ¢å¤ä»¥åŠåµŒå¥—å¯¼èˆªç­‰**ã€‚

```kotlin
@Composable
public fun Navigator(
    screen: Screen,
    disposeBehavior: NavigatorDisposeBehavior = NavigatorDisposeBehavior(),
    onBackPressed: OnBackPressed = { true },
    key: String = compositionUniqueId(),
    content: NavigatorContent = { CurrentScreen() }
)
```

ç¬¬ä¸€ä¸ªå…¥å‚å°±è¡¨ç¤ºè¯¥å¯¼èˆªåŒºåŸŸçš„ç¬¬ä¸€ä¸ªå±å¹•ã€‚

```kotlin
class SingleActivity : ComponentActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        setContent {
            Navigator(HomeScreen)
        }
    }
}
```

å½“æˆ‘ä»¬å¸Œæœ›è·³è½¬åˆ°å…¶å®ƒå±å¹•æ—¶ï¼Œå¯ä»¥é€šè¿‡ `LocalNavigator` è·å–åˆ°å½“å‰èŒƒå›´å†…æœ€è¿‘çš„é‚£ä¸ª Navigator å¯¹è±¡ï¼Œé€šè¿‡å®ƒå°±å¯ä»¥å‘å…¶ä»–é¡µé¢è·³è½¬ã€‚

```kotlin
@Composable
private fun PostCard(post: Post) {
    val navigator = LocalNavigator.currentOrThrow
    
    Card(
        modifier = Modifier.clickable { 
            navigator.push(PostDetailsScreen(post.id))
            // Also works:
            // navigator push PostDetailsScreen(post.id)
            // navigator += PostDetailsScreen(post.id)
        }
    ) {
        // ...
    }
}
```

å½“ç„¶ï¼Œå¦‚æœéœ€è¦åµŒå¥—é¡µé¢ï¼Œä¾‹å¦‚é¡¶éƒ¨ TAB åˆ‡æ¢ä¸åŒçš„ Screenï¼ŒVoyager ä¹Ÿå¯ä»¥è½»æ˜“å®ç°ã€‚

```kotlin
@Composable
override fun Content() {
    Navigator(HomeScreen) { navigator ->
        Scaffold(
            topBar = { /* ... */ },
            content = { CurrentScreen() },
            bottomBar = { /* ... */ }
        )
    }
}
```

**Navigator ç±»å®ç°äº† Stack æ¥å£**ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åƒç®¡ç† Stack ä¸€æ ·è½»æ¾çš„ç®¡ç† Screenã€‚

```kotlin
val stack = mutableStateStackOf("ğŸ‡", "ğŸ‰", "ğŸŒ", "ğŸ", "ğŸ¥", "ğŸ‹")
// ğŸ‡, ğŸ‰, ğŸŒ, ğŸ, ğŸ¥, ğŸ‹

stack.lastItemOrNull
// ğŸ‹

stack.push("ğŸ")
// ğŸ‡, ğŸ‰, ğŸŒ, ğŸ, ğŸ¥, ğŸ‹, ğŸ

stack.pop()
// ğŸ‡, ğŸ‰, ğŸŒ, ğŸ, ğŸ¥, ğŸ‹

stack.popUntil { it == "ğŸ" }
// ğŸ‡, ğŸ‰, ğŸŒ, ğŸ

stack.replace("ğŸ“")
// ğŸ‡, ğŸ‰, ğŸŒ, ğŸ“

stack.replaceAll("ğŸ’")
// ğŸ’
```

é€šè¿‡ä¸Šé¢çš„ API æˆ‘ä»¬å¯ä»¥è½»æ¾çš„æ§åˆ¶é¡µé¢å…³ç³»ã€‚

### BottomSheet navigation

Voyager åŒæ ·ä¹Ÿæ”¯æŒ BottomSheet navigationï¼Œåªéœ€è¦åœ¨ Navigator æœ€å¤–å±‚è®¾ç½®ä¸€ä¸‹å³å¯ã€‚

```kotlin
setContent {
    BottomSheetNavigator {
        Navigator(HomeScreen)
    }
}
```

ç„¶åé€šè¿‡ `LocalBottomShetNavigator.current` è·å–å¯¹åº”çš„ Navigator å¯¹è±¡ã€‚

```kotlin
@Composable
override fun Content() {
    val bottomSheetNavigator = LocalBottomSheetNavigator.current

    Button(
        onClick = { 
            bottomSheetNavigator.show(FrontScreen())
        }
    ) {
        Text(text = "Show BottomSheet")
    }
}
```

ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œç”¨çš„ä¸æ˜¯ Stack çš„ APIï¼Œè€Œæ˜¯ `BottomSheetNavigator` ç‹¬æœ‰çš„ `show/hide` å‡½æ•°æ¥æ§åˆ¶æ˜¾ç¤ºæˆ–éšè—ã€‚

### Tab navigation

Voyager è¿˜æ”¯æŒ Tab navigationã€‚

Tab æ¥å£ç»§æ‰¿äº† Screen æ¥å£ï¼Œå¦å¤–è¿˜æä¾›äº† `options` å±æ€§ç”¨äºæè¿° Tab çš„ä¸€äº›ä¿¡æ¯ã€‚

```kotlin
public data class TabOptions(
    val index: UShort,
    val title: String,
    val icon: Painter? = null
)

public interface Tab : Screen {

    public val options: TabOptions
        @Composable get
}
```

ä½¿ç”¨èµ·æ¥è·Ÿ Navigator ä¹Ÿå¾ˆç±»ä¼¼ï¼š

```kotlin
TabNavigator(HomeTab) {
    Scaffold(
        content = { 
            CurrentTab() 
        },
        bottomBar = {
            BottomNavigation {
                TabNavigationItem(HomeTab)
                TabNavigationItem(FavoritesTab)
                TabNavigationItem(ProfileTab)
            }
        }
    )
}
```

ç„¶åé€šè¿‡ `LocalTabNavigator.current` è·å–åˆ° TabNavigatorã€‚

```kotlin
@Composable
private fun RowScope.TabNavigationItem(tab: Tab) {
    val tabNavigator = LocalTabNavigator.current

    BottomNavigationItem(
        selected = tabNavigator.current == tab,
        onClick = { tabNavigator.current = tab },
        icon = { Icon(painter = tab.icon, contentDescription = tab.title) }
    )
}
```

### è·¨æ¨¡å—å¯¼èˆª

Voyager æä¾›äº†è·¨æ¨¡å—å¯¼èˆªçš„èƒ½åŠ›ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ª API æ¥å®Œæˆï¼š

- `ScreenProvider`ï¼šåœ¨å…¬å…±æ¨¡å—ä¸­æ³¨å†Œæ‰€æœ‰éœ€è¦è·¨æ¨¡å—è·³è½¬çš„ Screenã€‚
- `ScreenRegistry`ï¼šå°† ScreenProvider ä¸­æä¾›çš„ Screen æ³¨å†Œåˆ° Voyager ä¸­ã€‚
- `screenModule`ï¼šScreenRegistry è¾…åŠ©å·¥å…·ã€‚
- `rememberScreen`ï¼šè·å– ScreenProvider ä¸­æ³¨å†Œçš„ Screen å®ä¾‹ã€‚

å…·ä½“ä½¿ç”¨å¯ä»¥å»çœ‹ä¸‹[å®˜æ–¹æ–‡æ¡£](https://voyager.adriel.cafe/navigation/multi-module-navigation)ï¼Œé‡Œé¢å†™çš„å¾ˆè¯¦ç»†ï¼Œè€Œä¸”æœ‰ [Demo](https://github.com/adrielcafe/voyager/tree/main/samples/multi-module)ã€‚

ä¸è¿‡ï¼Œå…³äº Voyager çš„è·¨æ¨¡å—ä½¿ç”¨æˆ‘æ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦ï¼Œè€Œä¸”æˆ‘ç›®å‰çš„é¡¹ç›®æ˜¯æ’ä»¶åŒ–æ¶æ„ï¼Œè·¨æ¨¡å—å¾ˆå¤šæƒ…å†µä¸‹éœ€è¦é€šè¿‡è·¯ç”±æ²Ÿé€šï¼Œæ‰€ä»¥æˆ‘éœ€è¦å…ˆç”¨è·¯ç”±æ¡†æ¶è·å–åˆ°å…¶ä»–æ¨¡å—çš„ Screenï¼Œç„¶åå†å»æ‰“å¼€ï¼Œè·¯ç”±æ¡†æ¶æˆ‘ç”¨çš„æˆ‘ä¹‹å‰è‡ªå·±å†™çš„ [KRouter](https://github.com/0xZhangKe/KRouter)ã€‚

æ­¤å¤–ï¼ŒVoyager Navigation ä¹Ÿæ”¯æŒåµŒå¥—å¯¼èˆªï¼Œå¤šå±‚åµŒå¥—ï¼Œè¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ã€‚

## ScreenModel/ViewModel

Voyager ä¸­çš„ ScreenModel å’Œæˆ‘ä»¬å¹³æ—¶ç”¨çš„ ViewModel å‡ ä¹ä¸€è‡´ï¼Œåªä¸è¿‡è¦æ›´ç®€å•ï¼š

```kotlin
public interface ScreenModel {

    public fun onDispose() {}
}
```

ScreenModel æä¾›äº†å¯¹ Kotlin åç¨‹çš„æ”¯æŒï¼š

```kotlin
class PostDetailsScreenModel(
    private val repository: PostRepository
) : ScreenModel {

    fun getPost(id: String) {
        screenModelScope.launch {
            val post = repository.getPost(id)
            // ...
        }
    }
}
```

ç„¶åé€šè¿‡ `rememberScreenModel` å‡½æ•°è·å–åˆ° ScreenModel å¯¹è±¡ã€‚

```kotlin
@Composable
override fun Content() {
    val screenModel = rememberScreenModel { HomeScreenModel() }
}
```

ä¸å–œæ¬¢ä½¿ç”¨ ScreenModel çš„è¯ä¹Ÿå¯ä»¥æ¥ç€ä½¿ç”¨ ViewModelï¼Œè¿™ä¿©éƒ½æ˜¯ Voyager æ”¯æŒçš„ï¼Œæˆ‘ç”¨çš„å°±æ˜¯ ViewModelã€‚

```kotlin
@Composable
override fun Content() {
    val viewModel = viewModel<PostListViewModel>()
    // ...
}
```

### ä¾èµ–æ³¨å…¥

Voyager æ”¯æŒä¸‰ç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼šKoinã€Kodeinã€Hiltã€‚

è¿™é‡Œä»‹ç»ä¸‹ Hilt çš„ä½¿ç”¨ã€‚

è·Ÿæ™®é€šçš„ç±»ä¸€æ ·ï¼ŒScreenModel éœ€è¦åŠ ä¸Š `@Inject` æ³¨è§£ã€‚

```kotlin
class HomeScreenModel @Inject constructor() : ScreenModel
```

ç„¶åé€šè¿‡ `getScreenModel()` è·å–åˆ°å®ä¾‹ã€‚

```kotlin
@Composable
override fun Content() {
    val screenModel = getScreenModel<HomeScreenModel>()
}
```

`@AssistedInject` åŒæ ·ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚

```kotlin
class PostDetailsScreenModel @AssistedInject constructor(
    @Assisted val postId: Long
) : ScreenModel {

    @AssistedFactory
    interface Factory : ScreenModelFactory {
        fun create(postId: Long): PostDetailsScreenModel
    }
}

@Composable
override fun Content() {
    val screenModel = getScreenModel<PostDetailsScreenModel, PostDetailsScreenModel.Factory> { factory ->
        factory.create(postId)
    }
}
```

ä¸Šé¢å°±æ˜¯ Voyager åŸºæœ¬ä½¿ç”¨çš„ç®€å•ä»‹ç»ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€äº›æœ¬æ–‡æ²¡æœ‰ä»‹ç»çš„ç‰¹æ€§ï¼š

- Stack Api
- State restoration
- Transitions(è½¬åœºåŠ¨ç”»)
- Lifecycle
- Back pres
- Deep links

è¿™äº›éƒ½å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸Šæ‰¾åˆ°ä½¿ç”¨æ–¹å¼ï¼Œæœ¬æ–‡å°±ä¸å¤šåšä»‹ç»äº†ã€‚

ä¸‹é¢ä»‹ç»ä¸€äº›æˆ‘å¹³æ—¶ä½¿ç”¨æ—¶é‡åˆ°çš„ä¸€äº›ç‰¹åŒ–åœºæ™¯å’Œè§£å†³æ–¹æ¡ˆã€‚

# ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯

## é€æ˜é¡µé¢

é€æ˜é¡µé¢åœ¨ä¼ ç»Ÿ Activity/Fragment ä¸­å¾ˆå®¹æ˜“å®ç°ï¼Œä½†åœ¨ Jetpack Navigation å’Œ Voyager ä¸­éƒ½ä¸æ˜¯å¾ˆå®¹æ˜“ï¼Œè¿™é‡Œé¢çš„é—®é¢˜åœ¨äºï¼ŒCompose ä¸­çš„é¡µé¢å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ä¸€ä¸ªé¡µé¢ï¼Œä¾‹å¦‚ Voyager ä¸­çš„ Navigatorï¼Œ**å¯¼èˆªåˆ°ä¸€ä¸ªæ–°çš„é¡µé¢ä¹‹åä¸Šä¸€ä¸ªé¡µé¢å¹¶ä¸ä¼šè¢«æ¸²æŸ“ï¼Œåªä¼šæ¸²æŸ“æ–°çš„é¡µé¢**ï¼Œè™½ç„¶å®é™…ä¸Š Navigator API æ˜¯ç”¨ Stack ç®¡ç†çš„ï¼Œé¡µé¢ä¹Ÿæ˜¯ä¼šå åŠ çš„ï¼Œä½†ç›®å‰çš„å¯¼èˆªæ¡†æ¶éƒ½æ˜¯åªä¼šæ¸²æŸ“æœ€æ–°çš„é¡µé¢ï¼Œå¯¼è‡´å³ä½¿æ–°çš„é¡µé¢æ˜¯é€æ˜çš„ä¹Ÿæ²¡ç”¨ã€‚

æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ç±»ä¼¼ `BottomSheetNavigator` çš„æœºåˆ¶ï¼Œé¢å¤–æä¾›ä¸€ä¸ª `TransparentNavigator` ç”¨äºç®¡ç†é€æ˜é¡µé¢ã€‚

```kotlin
typealias TransparentNavigatorContent =
        @Composable (transparentNavigator: TransparentNavigator) -> Unit

val LocalTransparentNavigator: ProvidableCompositionLocal<TransparentNavigator> =
    staticCompositionLocalOf { error("TransparentNavigator not initialized") }

@Composable
fun TransparentNavigator(
    key: String = currentCompositeKeyHash.toString(35),
    transparentContent: TransparentNavigatorContent = { CurrentScreen() },
    content: TransparentNavigatorContent
) {
    Navigator(HiddenTransparentScreen, onBackPressed = null, key = key) { navigator ->
        val transparentNavigator = remember(navigator) {
            TransparentNavigator(navigator)
        }

        CompositionLocalProvider(
            LocalTransparentNavigator provides transparentNavigator
        ) {
            Box(modifier = Modifier.fillMaxSize()) {
                content(transparentNavigator)
                val lastItem = transparentNavigator.lastItemOrNull
                if (lastItem != null) {
                    BackHandler {
                        transparentNavigator.pop()
                    }
                    Box(
                        modifier = Modifier
                            .noRippleClick {}
                    ) {
                        transparentContent(transparentNavigator)
                    }
                }
            }
        }
    }
}

class TransparentNavigator internal constructor(
    private val navigator: Navigator,
) : Stack<Screen> by navigator

private object HiddenTransparentScreen : Screen {

    @Composable
    override fun Content() {
        Spacer(modifier = Modifier.height(1.dp))
    }
}
```

ç„¶åæŠŠ TransparentNavigator å¥—åœ¨æ ¹ Navigator çš„å¤–é¢ã€‚

```kotlin
TransparentNavigator {
    Navigator(HomeScreen)
}
```

ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼š

```kotlin
val transparentNavigator = LocalTransparentNavigator.current
// ...
transparentNavigator.push(PostListScreen)
```

## é¡µé¢äº‹ä»¶å›è°ƒ

ç±»ä¼¼äº `startActivityFroResult` ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™å¸Œæœ›æ‰“å¼€ Screen ä¹‹åèƒ½æ¥æ”¶åˆ°è¿™ä¸ª Screen çš„ä¸€äº›å›è°ƒï¼ŒVoyager æœ¬èº«æ˜¯æ²¡æœ‰å¯¹è¿™ç§åœºæ™¯çš„æ”¯æŒçš„ï¼Œåæ¥æˆ‘æ‰¾åˆ°äº†ä¸ªåŠæ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒæœŸå¾…åé¢å®˜æ–¹å¯ä»¥æ”¯æŒã€‚

å¤§ä½“ä¸Šå°±æ˜¯åˆ©ç”¨ `NavigatorLifecycleStore` API å­˜å‚¨ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå¯ä»¥è·¨è¶Šé¡µé¢çš„è‡ªå®šä¹‰çš„å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªå¯¹è±¡ä¸­ç»´æŠ¤ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œåœ¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸­å­˜å‚¨é¡µé¢çš„è¿”å›æ•°æ®ã€‚

```kotlin
val Navigator.navigationResult: VoyagerResultExtension
    @Composable get() = remember {
        NavigatorLifecycleStore.get(this) {
            VoyagerResultExtension(this)
        }
    }

class VoyagerResultExtension(
    private val navigator: Navigator
) : NavigatorDisposable {
    private val results = mutableStateMapOf<String, Any?>()

    override fun onDispose(navigator: Navigator) {
        // not used
    }

    public fun popWithResult(result: Any? = null) {
        val currentScreen = navigator.lastItem
        results[currentScreen.key] = result
        navigator.pop()
    }

    public fun clearResults() {
        results.clear()
    }

    public fun popUntilWithResult(predicate: (Screen) -> Boolean, result: Any? = null) {
        val currentScreen = navigator.lastItem
        results[currentScreen.key] = result
        navigator.popUntil(predicate)
    }

    @Composable
    public fun <T> getResult(screenKey: String): State<T?> {
        val log = results.keys.joinToString(", ") { key ->
            "$key:${results[key]}"
        }
        val result = results[screenKey] as? T
        val resultState = remember(screenKey, result) {
            derivedStateOf {
                results.remove(screenKey)
                result
            }
        }
        return resultState
    }
}
```

ç”¨æ³•å¦‚ä¸‹ï¼š

```kotlin
// Screen A
val result by navigator.navigationResult.getResult<String>(lastItemKey)

// Screen B
val navigationResult = navigator.navigationResult
navigationResult.popWithResult("result")
```

ä¸Šé¢çš„ä»£ç ä¸­ç”¨ A æ‰“å¼€äº†é¡µé¢ Bï¼Œå¹¶è·å–å®ƒçš„è¿”å›å€¼ï¼Œå…¶ä¸­çš„ `lastItemKey` æ˜¯æŒ‡ B é¡µé¢çš„ Keyã€‚

æ–‡ç« çš„å¼€å¤´æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Screen æ¥å£ä¸­åŒ…å«ä¸€ä¸ª Key å±æ€§ï¼Œè¿™ä¸ªå±æ€§æœ‰ä¸ªé»˜è®¤å®ç°ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚å¦‚æœä¸ B é¡µé¢çº¦å®šå¥½ä¸€ä¸ªé¡µé¢çš„ Keyï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨è¿™ä¸ª Key æ¥ä¼ è¾“æ•°æ®äº†ã€‚

## å…¨å±€å¯¼èˆª

åœ¨ä½¿ç”¨ TabNavigator æ—¶æˆ‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘çš„é¡µé¢å¸ƒå±€æ˜¯åº•éƒ¨å¤šä¸ªå¯¼èˆªæŒ‰é’®ï¼Œç‚¹å‡»æŒ‰é’®åˆ‡æ¢ TABï¼Œåœ¨ TAB å†…éƒ¨ç‚¹å‡»æŸä¸ªæŒ‰é’®è·³è½¬åˆ°äºŒçº§é¡µé¢æ—¶ä¸€èˆ¬æ˜¯ç›´æ¥ä½¿ç”¨ `LocalNavigator.current` æ¥è·å–å½“å‰çš„ Navigator è¿›è¡Œè·³è½¬ï¼Œä½†æ­¤æ—¶æ‹¿åˆ°çš„ Navigator å…¶å®æ˜¯ TabNavigatorï¼Œè·³è½¬åˆ°æ–°çš„é¡µé¢ä¼šå‘ç°äºŒçº§é¡µé¢çš„åº•éƒ¨ä»ç„¶æœ‰é¦–é¡µçš„å‡ ä¸ªåº•éƒ¨å¯¼èˆªæŒ‰é’®ã€‚

Navigator è¢«è®¾è®¡ä¸ºé“¾è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªé“¾è¡¨å‘ä¸Šè¿½æº¯åˆ°æ ¹ Navigator ç„¶åè·³è½¬å°±è¡Œäº†ï¼Œæˆ–è€…è¿½æº¯åˆ°ä¸Šä¸€ä¸ª Navigatorï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬çš„ Navigator åµŒå¥—å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬è·å–åˆ°çš„å¯èƒ½æ˜¯ `BottomSheetNavigator`ã€ `TransparentNavigator` ç­‰ï¼Œæœ‰ç‚¹éº»çƒ¦ã€‚

å› æ­¤ï¼Œæˆ‘æä¾›äº†ä¸€ä¸ªå…¨å±€ Navigator ç”¨äºé¡µé¢è·³è½¬ä»¥åŠæ§åˆ¶å¯¼èˆªæ–¹å‘ã€‚

```kotlin
val LocalGlobalNavigator: ProvidableCompositionLocal<Navigator> =
    staticCompositionLocalOf { error("LocalGlobalNavigator not initialized") }
```

ç„¶ååœ¨æ ¹ Navigator åˆæä¾›å€¼ï¼š

```kotlin
// MainActivity.kt
setContent {
	TransparentNavigator {
	    BottomSheetNavigator {
	        Navigator(HomeScreen)
	    }
	}
}

// HomeScreen.kt
object HomeScreen : Screen {

    @Composable
    override fun Content() {
        CompositionLocalProvider(
            LocalGlobalNavigator provides LocalNavigator.currentOrThrow
        ) {

        }
    }
}
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `LocalGlobalNavigator` æ‹¿åˆ°å…¨å±€ Navigator äº†ã€‚

åé¢å¦‚æœæˆ‘ä»¬åœ¨ TabNavigator çš„å†…éƒ¨ï¼Œå°±å¯ä»¥é€šè¿‡ `LocalGlobalNavigator` æ¥è·³è½¬åˆ°äºŒçº§é¡µï¼Œä»è€Œé€ƒè„± TabNavigator çš„æŸç¼šã€‚

## HorizontalPager ç»“åˆä½¿ç”¨

åœ¨ä½¿ç”¨ `HorizontalPager` æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æ¯ä¸ª Page éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ ViewModelï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨ Voyager æ˜¯æœ‰ç‚¹éº»çƒ¦çš„ï¼Œå¦‚æœåœ¨ Pager å†…éƒ¨ç›´æ¥ä½¿ç”¨ Navigator åˆ›å»ºç‹¬ç«‹ Screen ä¹Ÿå¯ä»¥å®ç°è¿™æ ·çš„éœ€æ±‚ï¼Œä½†æ˜¯ Page åˆ‡æ¢æ—¶çŠ¶æ€ä¼šå®Œå…¨ä¸¢å¤±ã€‚

æˆ‘ä»¿ç…§ Voyager Tab åšäº†ä¸€ä¸ª PagerTab ç”¨äºè§£å†³è¯¥é—®é¢˜ã€‚

```kotlin
interface PagerTab {

    val options: PagerTabOptions?
        @Composable get

    @Composable
    fun Screen.TabContent()
}

data class PagerTabOptions(
    val title: String,
    val icon: Painter? = null
)
```

TabContent å‡½æ•°ä¹‹æ‰€ä»¥æœ‰ä¸ª Screen Receiver æ˜¯å› ä¸ºéœ€è¦åˆ›å»º ViewModel/ScreenModelã€‚

```kotlin
@Composable
override fun Content() {
    val tab = remember {
        listOf(ProfileTab(), MessageTab())
    }
    val state = rememberPagerState {
        tab.size
    }
    HorizontalPager(
        state = state,
    ) { pageIndex ->
        with(tab[pageIndex]) {
            TabContent()
        }
    }
}
```

è¿™æ ·ï¼Œæ¯ä¸ª Page å°±éƒ½æœ‰äº†ç‹¬ç«‹çš„ ViewModelï¼Œè¿™åœ¨æœ‰å¤šç§ä¸åŒ TAB çš„æƒ…å†µä¸‹å°¤å…¶é‡è¦ã€‚

å¥½äº†ï¼Œå…³äº Voyager çš„ä»‹ç»å°±åˆ°è¿™é‡Œäº†ï¼Œå†æ¬¡æ¨èè¿™ä¸ªæ¡†æ¶ï¼ŒçœŸçš„å¾ˆå¥½ç”¨ã€‚